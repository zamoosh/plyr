<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="John Doe">
        <link rel="shortcut icon" href="" type="image/x-icon">
        <link rel="stylesheet" href="./static/assets/css/bootstrap.css">
        <link rel="stylesheet" href="./static/assets/css/bootstrap-icons/bootstrap-icons.css">
        
        <!--         <link rel="stylesheet" href="https://cdn.plyr.io/3.7.2/plyr.css" /> -->
        <link rel="stylesheet" href="./static/assets/plugins/plyr/plyr.css" />
        
        <title>player</title>
        <style>
            * {
                box-sizing: border-box;
            }
            
            ul {
                padding: 0 20px;
            }
            
            li {
                display: inline;
            }
            
            
            #bookmark_container {
                position: relative;
            }
            
            span.bookmark {
                position: absolute;
                color: red;
                transform: scale(1.6, 1.6);
                z-index: 99;
                top: 11px;
                cursor: pointer;
            }
            
            
            figure > #controllers {
                position: absolute;
                top: calc(91%);
            }
            
            figure > #controllers #play_pause i {
                font-size: 35px;
            }
            
            figure > #controllers .progress_bar,
            figure > #controllers .time {
                padding-top: 12px;
            }
            
            #progress {
                filter: hue-rotate(5deg);
                border: 1px solid #bebebe70;
                width: 100%;
                height: 7px;
                border-radius: 4px;
                background-color: transparent;
                cursor: pointer;
            }
        </style>
    </head>
    <body>
        
        <div class="container-fluid">
            <div class="container mt-4">
                
                <h3 class="ali" style="color: red; position: absolute; z-index: 9999999999999999999999">sdfe</h3>
                <video id="player" controls data-poster="hosein_mohammadi.png">
                    <source src="mov_bbb.mp4" type="video/mp4" />
                    <source src="mov_bbb.mp4" type="video/webm" />
                    
                    <!-- Captions are optional -->
                    <!-- <track kind="captions" label="English captions" src="/path/to/captions.vtt" srclang="en" default /> -->
                </video>
                
                
                <!-- <figure id="container" class="position-relative">
                    <h3 style="color: red; position: absolute">sdfe</h3>
                    <video class="w-100 img-fluid rounded"
                           id="video"
                           preload="metadata">
                        <source type="video/mp4" src="mov_bbb.mp4">
                        <a href="mov_bbb.mp4">Download MP4</a>
                    </video>
                    <div class="w-100" id="controllers">
                        <div class="w-100 d-flex col-12 px-2">
                            &lt;!&ndash; play pause button &ndash;&gt;
                            <div class="text-white"
                                 id="play_pause">
                                <i class="bi bi-play-fill text-white play"
                                   role="button"></i>
                            </div>
                            
                            &lt;!&ndash; progress bar &ndash;&gt;
                            <div class="w-75 progress_bar">
                                <div id="bookmark_container"></div>
                                <progress id="progress"
                                    value="0"
                                    min="0">
                                    <span id="progress-bar"></span>
                                </progress>
                            </div>
                            
                            &lt;!&ndash; progress bar &ndash;&gt;
                            <div class="text-white time mx-2" id="time"></div>
                        </div>
                    </div>
                </figure> -->
            </div>
        </div>
        
        <!--  <ul id="video-controls" class="controls">
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="playpause" type="button">Play/Pause</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="stop" type="button">Stop</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             <li class="progress">
                &lt;!&ndash;  <div id="bookmark_container"></div>
                 <progress
                     id="progress"
                     value="0"
                     min="0">
                     <span id="progress-bar"></span>
                 </progress> &ndash;&gt;
                 &lt;!&ndash;                     <span class="bookmark" style="position:absolute;left: 90%;top: 0;bottom: 0;">|</span> &ndash;&gt;
             </li>
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="mute" type="button">Mute/Unmute</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             <li>
                 <button id="vol_up" type="button">Vol+</button>
             </li>
             <li>
                 <button id="vol_down" type="button">Vol-</button>
             </li>
             <li>
                 <button id="comment" type="button">comment</button>
             </li>
             <li>
                 <button id="fs" type="button">Fullscreen</button>
             </li>
         </ul> -->
        
        <script src="./static/assets/plugins/plyr/plyr.polyfilled.js"></script>
        
        <script src="./static/assets/js/bootstrap.js"></script>
        <script src="./static/assets/js/bootstrap.bundle.js"></script>
        
        <script>
            window.addEventListener('load', function () {
                const player = new Plyr('#player', {
                    title: 'ali ali ali',
                    previewThumbnails: {enabled: false, src: ''},
                    speed: {
                        selected: 1,
                        options: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 4, 5, 6, 7]
                    },
                    markers: {
                        enabled: true,
                        points: [
                            {time: 2, label: 'ali'},
                            {time: 9, label: 'sara'}
                        ]
                    },
                    captions: {
                        active: false,
                        language: 'auto',
                        update: false
                    },
                    tooltips: {
                        controls: true,
                        seek: true
                    },
                    clickToPlay: true
                });
                let container = document.getElementById('container');
                let video = document.getElementById('video');
                let fullscreen = document.getElementById('fs');
                let play_pause = document.getElementById('play_pause');
                let comment = document.getElementById('comment');
                let progress = document.getElementById('progress');
                let progressBar = document.getElementById('progress-bar');
                let vol_up = document.getElementById('vol_up');
                let vol_down = document.getElementById('vol_down');
                
                let style = window.getComputedStyle(progress, null).getPropertyValue('font-size');
                let fontSize = parseFloat(style);
                
                let progress_container = document.getElementsByTagName('ul')[0];
                let correct_width = video.getBoundingClientRect()['width'];
                let a = correct_width / fontSize;
                progress_container.style.width = `${correct_width}px`;
                
                video.addEventListener('ended', function () {
                    let play = document.getElementsByClassName('play')[0];
                    play.classList.remove('bi-stop-fill');
                    play.classList.add('bi-play-fill');
                });
                
                play_pause.addEventListener('click', (e) => {
                    let play = document.getElementsByClassName('play')[0];
                    if (video.paused || video.ended) {
                        video.play();
                        play.classList.remove('bi-play-fill');
                        play.classList.add('bi-stop-fill');
                    } else {
                        video.pause();
                        play.classList.remove('bi-stop-fill');
                        play.classList.add('bi-play-fill');
                    }
                });
                
                
                function change_volume(dir) {
                    let current_volume = Math.floor(video.volume * 10) / 10;
                    if (dir === '+' && current_volume < 1) {
                        if (video.volume > 0.89)
                            video.volume = 1;
                        else
                            video.volume += 0.1;
                    } else if (dir === '-' && current_volume > 0) {
                        if (video.volume < 0.11)
                            video.volume = 0;
                        else
                            video.volume -= 0.1;
                    }
                }
                
                vol_up.addEventListener('click', function () {
                    change_volume('+');
                });
                
                vol_down.addEventListener('click', function () {
                    change_volume('-');
                });
                
                progress.setAttribute('max', video.duration);
                
                
                let total_time = Math.floor(video.duration);
                let current_time = Math.floor(video.currentTime);
                let result = `${current_time} / ${total_time}`;
                let time = document.getElementById('time');
                time.innerHTML = result;
                video.addEventListener('timeupdate', function () {
                    let total_time = Math.floor(video.duration);
                    let current_time = Math.floor(video.currentTime);
                    let result = `${current_time} / ${total_time}`;
                    let time = document.getElementById('time');
                    time.innerHTML = result;
                    progress.value = video.currentTime;
                    
                });
                
                progress.addEventListener('click', (e) => {
                    let rect = progress.getBoundingClientRect();
                    let pos = (e.pageX - rect.left) / progress.offsetWidth;
                    video.currentTime = pos * video.duration;
                });
                
                comment.addEventListener('click', function () {
                    let current_point = (progress.value * 100) / video.duration;
                    let bookmark_container = document.getElementById('bookmark_container');
                    let current_second = Math.floor(progress.value);
                    let item = `<span class="bookmark" title="${current_point} S" style="left: ${current_point}%;">|</span>`;
                    bookmark_container.innerHTML += item;
                });
                
                fullscreen.addEventListener('click', function () {
                    if (container.requestFullScreen) {
                        container.requestFullScreen();
                        console.log('one');
                    } else if (container.webkitRequestFullScreen) {
                        container.webkitRequestFullScreen();
                    } else if (container.mozRequestFullScreen) {
                        container.mozRequestFullScreen();
                    }
                });
            });
        </script>
    </body>
</html>