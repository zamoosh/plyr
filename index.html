<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="John Doe">
        <link rel="shortcut icon" href="" type="image/x-icon">
        <link rel="stylesheet" href="./static/assets/css/bootstrap.css">
        <link rel="stylesheet" href="./static/assets/css/bootstrap-icons/bootstrap-icons.css">
        
        <link rel="stylesheet" href="./static/assets/plugins/plyr/plyr.css" />
        
        <title>player</title>
        <style>
            
            .plyr__controls {
                /*background-image: url("./static/assets/qr.png") !important;*/
                /*background-position: center !important;*/
                /*background-size: 100px !important;*/
                /*background-repeat: no-repeat !important;*/
                /*background: url('./static/assets/qr_new.png') top no-repeat, linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, .5)) !important;*/
                /*background-size: 60px 60px, auto !important;*/
            }
            
            /*.plyr__video-wrapper::before {*/
            /*    position: absolute;*/
            /*    top: 30px;*/
            /*    left: 30px;*/
            /*    z-index: 10;*/
            /*    content: url('./static/assets/vidan-logo-shape.svg');*/
            /*    opacity: 0.2;*/
            /*}*/
            
            .plyr__video-wrapper::before {
                position: absolute;
                top: 25px;
                left: 25px;
                z-index: 10;
                content: '';
                height: 16%;
                width: 11%;
                background: url('./static/assets/vidan-logo-shape.svg') no-repeat;
                opacity: 0.5;
            }
            
        </style>
    </head>
    <body>
        
        <div class="container-fluid">
            <div class="container mt-4">
    
                <video playsinline
                       id="player"
                       controls
                       data-poster="">
                    <source src="./static/assets/videos/sea_640.mp4" type="video/mp4" size="640" />
                    <source src="./static/assets/videos/sea_960.mp4" type="video/mp4" size="960" />
                    <source src="./static/assets/videos/sea_1280.mp4" type="video/mp4" size="1280" />
                    
                    <!-- Captions are optional -->
                    <!-- <track kind="captions" label="English captions" src="/path/to/captions.vtt" srclang="en" default /> -->
                    <track src="">
                </video>
                <!-- <figure id="container" class="position-relative">
                    <h3 style="color: red; position: absolute">sdfe</h3>
                    <video class="w-100 img-fluid rounded"
                           id="video"
                           preload="metadata">
                        <source type="video/mp4" src="mov_bbb.mp4">
                        <a href="mov_bbb.mp4">Download MP4</a>
                    </video>
                    <div class="w-100" id="controllers">
                        <div class="w-100 d-flex col-12 px-2">
                            &lt;!&ndash; play pause button &ndash;&gt;
                            <div class="text-white"
                                 id="play_pause">
                                <i class="bi bi-play-fill text-white play"
                                   role="button"></i>
                            </div>
                            
                            &lt;!&ndash; progress bar &ndash;&gt;
                            <div class="w-75 progress_bar">
                                <div id="bookmark_container"></div>
                                <progress id="progress"
                                    value="0"
                                    min="0">
                                    <span id="progress-bar"></span>
                                </progress>
                            </div>
                            
                            &lt;!&ndash; progress bar &ndash;&gt;
                            <div class="text-white time mx-2" id="time"></div>
                        </div>
                    </div>
                </figure> -->
            </div>
        </div>
        
        <!--  <ul id="video-controls" class="controls">
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="playpause" type="button">Play/Pause</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="stop" type="button">Stop</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             <li class="progress">
                &lt;!&ndash;  <div id="bookmark_container"></div>
                 <progress
                     id="progress"
                     value="0"
                     min="0">
                     <span id="progress-bar"></span>
                 </progress> &ndash;&gt;
                 &lt;!&ndash;                     <span class="bookmark" style="position:absolute;left: 90%;top: 0;bottom: 0;">|</span> &ndash;&gt;
             </li>
             &lt;!&ndash;             <li> &ndash;&gt;
             &lt;!&ndash;                 <button id="mute" type="button">Mute/Unmute</button> &ndash;&gt;
             &lt;!&ndash;             </li> &ndash;&gt;
             <li>
                 <button id="vol_up" type="button">Vol+</button>
             </li>
             <li>
                 <button id="vol_down" type="button">Vol-</button>
             </li>
             <li>
                 <button id="comment" type="button">comment</button>
             </li>
             <li>
                 <button id="fs" type="button">Fullscreen</button>
             </li>
         </ul> -->
    
    
        <script src="./static/assets/js/bootstrap.js"></script>
        <script src="./static/assets/js/bootstrap.bundle.js"></script>
        <script src="./static/assets/plugins/plyr/plyr.polyfilled.js"></script>
    
        <script>
            window.addEventListener('load', function () {
                let video = document.getElementById('player');
                function togglePictureInPicture() {
                    if (document.pictureInPictureElement) {
                        document.exitPictureInPicture();
                    } else if (document.pictureInPictureEnabled) {
                        video.requestPictureInPicture();
                    }
                }
                togglePictureInPicture()

                const player = new Plyr('#player', {
                    settings: ['captions', 'quality', 'speed'],
                    controls: [
                        'play-large',
                        'play',
                        'rewind',
                        'fast-forward',
                        'restart',
                        'progress',
                        'current-time',
                        'mute', 'volume',
                        'captions',
                        'settings', 'pip',
                        'airplay',
                        'fullscreen',
                    ],
                    hideControls: false,
                    quality: {
                        default: 1280,
                        // The options to display in the UI, if available for the source media
                        options: [1280, 960, 640],
                        forced: true,
                        onChange: null
                    },
                    title: 'ali ali ali',
                    previewThumbnails: {
                        enabled: false,
                        src: ''
                    },
                    speed: {
                        selected: 1,
                        options: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2, 4]
                    },
                    markers: {
                        enabled: true,
                        points: [
                            {time: 2, label: 'ali'},
                            {time: 9, label: 'sara'}
                        ]
                    },
                    captions: {
                        active: false,
                        language: 'auto',
                        update: false
                    },
                    tooltips: {
                        controls: true,
                        seek: true
                    },
                    clickToPlay: true
                });
    
                console.log(Plyr);
                
                let comment = document.createElement('button');
                comment.classList.add('plyr__controls__item')
                comment.classList.add('plyr__control')
                comment.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chat-text" viewBox="0 0 16 16">
                  <path d="M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"/>
                  <path d="M4 5.5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zM4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8zm0 2.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5z"/>
                </svg>
                <span class="label--not-pressed plyr__tooltip">Add comment</span>
                `;
                let control_bar = document.getElementsByClassName('plyr__controls')[0];
                control_bar.appendChild(comment)
                
                comment.addEventListener('click', function () {
                    let progress_bar = document.querySelector('div.plyr__progress');
                    let progress_input = progress_bar.childNodes[0];
                    let current_time = progress_input.getAttribute('aria-valuenow');
                    current_time = Math.floor(current_time * 100) / 100;
                    console.log(current_time);
                });
                
                // player.source = {
                //     type: 'video',
                //     sources: [
                //         {
                //             src: 'bTqVqk7FSmY',
                //             provider: 'youtube'
                //         }
                //     ]
                // };
                
                // setTimeout(function () {
                //     let html = `<div class="video" style="position: absolute; top: 0px; left: 5px; font-size:10px; color: #fff; z-index:10">My Website Name</div>`;
                //     let plyr_controls = document.querySelector('.plyr__controls');
                //     plyr_controls.after(html);
                // }, 2000);
                
                let b = document.querySelector('button[data-plyr="fullscreen"]');
                b.addEventListener('click', function () {
                    // let plyr_full_page = document.querySelector('div.plyr--full-ui');
                    // let inner_html = plyr_full_page.innerHTML;
                    // let item = `<h3 class="ali" style="color: red; position: absolute; z-index: 999">sdfe</h3>`;
                    // let new_inner_html = item;
                    // new_inner_html += inner_html;
                    // plyr_full_page.innerHTML = new_inner_html;
                    // console.log(plyr_full_page);
                });
                
                
                /*let container = document.getElementById('container');
                let video = document.getElementById('video');
                let fullscreen = document.getElementById('fs');
                let play_pause = document.getElementById('play_pause');
                let comment = document.getElementById('comment');
                let progress = document.getElementById('progress');
                let progressBar = document.getElementById('progress-bar');
                let vol_up = document.getElementById('vol_up');
                let vol_down = document.getElementById('vol_down');
                
                let style = window.getComputedStyle(progress, null).getPropertyValue('font-size');
                let fontSize = parseFloat(style);
                
                let progress_container = document.getElementsByTagName('ul')[0];
                let correct_width = video.getBoundingClientRect()['width'];
                let a = correct_width / fontSize;
                progress_container.style.width = `${correct_width}px`;
                
                video.addEventListener('ended', function () {
                    let play = document.getElementsByClassName('play')[0];
                    play.classList.remove('bi-stop-fill');
                    play.classList.add('bi-play-fill');
                });
                
                play_pause.addEventListener('click', (e) => {
                    let play = document.getElementsByClassName('play')[0];
                    if (video.paused || video.ended) {
                        video.play();
                        play.classList.remove('bi-play-fill');
                        play.classList.add('bi-stop-fill');
                    } else {
                        video.pause();
                        play.classList.remove('bi-stop-fill');
                        play.classList.add('bi-play-fill');
                    }
                });
                
                
                function change_volume(dir) {
                    let current_volume = Math.floor(video.volume * 10) / 10;
                    if (dir === '+' && current_volume < 1) {
                        if (video.volume > 0.89)
                            video.volume = 1;
                        else
                            video.volume += 0.1;
                    } else if (dir === '-' && current_volume > 0) {
                        if (video.volume < 0.11)
                            video.volume = 0;
                        else
                            video.volume -= 0.1;
                    }
                }
                
                vol_up.addEventListener('click', function () {
                    change_volume('+');
                });
                
                vol_down.addEventListener('click', function () {
                    change_volume('-');
                });
                
                progress.setAttribute('max', video.duration);
                
                
                let total_time = Math.floor(video.duration);
                let current_time = Math.floor(video.currentTime);
                let result = `${current_time} / ${total_time}`;
                let time = document.getElementById('time');
                time.innerHTML = result;
                video.addEventListener('timeupdate', function () {
                    let total_time = Math.floor(video.duration);
                    let current_time = Math.floor(video.currentTime);
                    let result = `${current_time} / ${total_time}`;
                    let time = document.getElementById('time');
                    time.innerHTML = result;
                    progress.value = video.currentTime;
                    
                });
                
                progress.addEventListener('click', (e) => {
                    let rect = progress.getBoundingClientRect();
                    let pos = (e.pageX - rect.left) / progress.offsetWidth;
                    video.currentTime = pos * video.duration;
                });
                
                comment.addEventListener('click', function () {
                    let current_point = (progress.value * 100) / video.duration;
                    let bookmark_container = document.getElementById('bookmark_container');
                    let current_second = Math.floor(progress.value);
                    let item = `<span class="bookmark" title="${current_point} S" style="left: ${current_point}%;">|</span>`;
                    bookmark_container.innerHTML += item;
                });
                
                fullscreen.addEventListener('click', function () {
                    if (container.requestFullScreen) {
                        container.requestFullScreen();
                        console.log('one');
                    } else if (container.webkitRequestFullScreen) {
                        container.webkitRequestFullScreen();
                    } else if (container.mozRequestFullScreen) {
                        container.mozRequestFullScreen();
                    }
                });*/
            });
        </script>
    </body>
</html>